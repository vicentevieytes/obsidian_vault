Vicente Vieytes     -     25/10/23

# Introducción
Se realizó un test de penetración simulando un atacante en contra del host dev.engiemx.teknosgroup.com.
El testing se realizó sin autenticación.
## Metodología
Se siguió la siguiente metodología:
- Enumeración de directorios y reconocimiento del mapa del sitio.
- Escaneo dinámico en profundidad de todo el mapa del sitio.
- Fuzzing de la API.
- Diagnostico de problemas detectados.

***
### Enumeración
Se realizó una tarea de descubrimiento de contenido en el sitio. Los siguientes son los directorios, recursos y llamadas a la API que se encontraron:
![[Pasted image 20231025100739.png]]

El descubrimiento fue facilitado por una debilidad en la configuración que permite listado de directorio para algunos directorios.
![[Pasted image 20231025101018.png]]
![[Pasted image 20231025101036.png]]
![[Pasted image 20231025101051.png]]
![[Pasted image 20231025101224.png]]



## Escaneo del objetivo
Se ejecutaron tareas de escaneo en profundidad para de todos estos recursos descubiertos. Luego se procedió a remover todos los falsos positivos y los issues poco importantes. El reporte de issues relevantes fue exportado y se encuentra adjunto.

#### Diagnóstico de los issues:
- **Certificado TLS** 
	Burpsuite detectó este problema porque utiliza la Java Trust Store para verificar los certificados, esta no incluye el certificado emitido por Let's Encrypt. Pero **el certificado es válido y el transporte seguro funciona**.
- **Dependencias vulnerables de Javascript**
	Burpsuite detectó que la aplicación utiliza Angular 1.4.7 y jquery 2.1.4, librerías que presentan varias vulnerabilidades. Estas vulnerabilidades varían e incluyen XSS común y bypass de CSP. De todos modos, **no se encontraron puntos de inyección ni explotación** de este tipo de vulnerabilidades sin tener acceso autenticado a la aplicación.
- **Disclosure de código fuente**
	Burpsuite detecta que el archivo /libs/vendors_9.v05259.js contiene código server-side escrito en ASP, a primera vista esto parece ser un **falso positivo** ya que el archivo es de código javascript.
- **Politicas CORS**
	Cross-Origin Resource Sharing es cuando una aplicación permite que otras aplicaciones web de origen distinto accedan a sus recursos.
	En este caso, la API tiene la configuración "Access-Control-Allow-Origin:\*". Esto indica que cualquier aplicación de cualquier origen puede hacer llamados a la API, esto puede llevar a ataques CSRF ya que básicamente desactiva la "same origin policy". 
	**Se recomienda utilizar una whitelist de origenes confiados para llamar a la API, o desactivar CORS en caso de no necesitarlo.**
- **Directory listing**
	Esta es la falla que se utilizó para la enumeración. Gracias al listado de directorio se pudo descargar todo el contenido de /modules y /libs. Si bien los usuarios tienen que poder llegar al código para poder correr la aplicación, el listado de directorio da demasiada visibilidad.
	Habiendo descargado el código del front-end de la aplicación, **un atacante puede analizar la estructura del sitio sin necesidad de inciar sesión.**
- **HTML no especifica charset**
	La aplicación no indica que charset utilizar, esto significa que el browser y el server tienen que analizar el tipo de encoding y a partir de eso renderizar la aplicación, esto puede llevar a fallas en el funcionamiento.
	**Esto no representa una falla de seguridad necesariamente**, aunque podría llegar a traer problemas en caso de que se utilice un WAF o algún tipo de filtrado de contenido donde usar caracteres UTF-7 podría funcionar como un bypass.
<div style="page-break-after: always;"></div>
## Fuzzing de la API
Se realizó una tarea de fuzzing sobre dos queries distintas de GraphQL. En esta tarea, se inyectaron payloads conocidos de distintas vulnerabilidades en distintos campos de input.
Los payloads están diseñados para encontrar vulnerabilidades NoSQL injection, SQL injection, Out Of Band, JSON_XML injection, path traversal, template injection y en general utilizan distintos caracteres y formatos que buscan generar comportamiento inesperado en la API.

No se consiguieron respuestas anómalas, las respuestas se dividieron en tres tipos:
- Error de sintaxis cuando se utilizaban caracteres o tipos inesperados y no se respetaba el formato de GraphQL.
  ![[Pasted image 20231025105352.png]]
- Error de usuario o código de autenticación incorrecto haciendo fuzzing sobre la query auth_setPassUsuario.
  ![[Pasted image 20231025105448.png]]
- Error interno de GraphQL cuando en la query auth_setPassUsuario se utilizaban paréntesis o brackets sin cerrar.![[Pasted image 20231025105516.png]]
**No se consiguieron respuestas anómalas ni se encontraron vulnerabilidades en el funcionamiento de la API sin autenticación.**